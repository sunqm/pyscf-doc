<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Multi-configuration self-consistent field (MCSCF) &#8212; PySCF</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pyscf.css?v=9b431c29" />
    <script src="../_static/documentation_options.js?v=4d935f96"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/favicon-32x32.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multi-reference perturbation theory (MRPT)" href="mrpt.html" />
    <link rel="prev" title="Auxiliary second-order Green’s function perturbation theory (AGF2)" href="agf2.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=pyscf data-md-color-accent=pyscf>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#user/mcscf" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="PySCF"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">PySCF 2.4</span>
          <span class="md-header-nav__topic"> Multi-configuration self-consistent field (MCSCF) </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Home</a></li>
            
            <li class="md-tabs__item"><a href="../install.html" class="md-tabs__link">Install</a></li>
            
            <li class="md-tabs__item"><a href="../quickstart.html" class="md-tabs__link">Quickstart</a></li>
            
            <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
            
            <li class="md-tabs__item"><a href="../develop.html" class="md-tabs__link">Developer Guide</a></li>
            
            <li class="md-tabs__item"><a href="../pyscf_api_docs/modules.html" class="md-tabs__link">API</a></li>
            
            <li class="md-tabs__item"><a href="../about.html" class="md-tabs__link">About</a></li>
          <li class="md-tabs__item"><a href="../user.html" class="md-tabs__link">User Guide</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="PySCF" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="PySCF">PySCF 2.4</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/pyscf/pyscf/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    PySCF
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../install.html" class="md-nav__link">Install PySCF</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../install.html#advanced-build-options" class="md-nav__link">Advanced build options</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../install.html#install-pyscf-extensions" class="md-nav__link">Install PySCF extensions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../install.html#troubleshooting" class="md-nav__link">Troubleshooting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../quickstart.html" class="md-nav__link">Quickstart</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../user.html" class="md-nav__link">User Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="gto.html" class="md-nav__link">Molecular structure</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="scf.html" class="md-nav__link">Self-consistent field (SCF) methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dft.html" class="md-nav__link">Density functional theory (DFT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mp.html" class="md-nav__link">Second-order Møller–Plesset perturbation theory (MP2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="gw.html" class="md-nav__link">GW approximation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ci.html" class="md-nav__link">Configuration interaction (CISD and FCI)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cc.html" class="md-nav__link">Coupled-cluster theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="adc.html" class="md-nav__link">Algebraic diagrammatic construction (ADC)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="agf2.html" class="md-nav__link">Auxiliary second-order Green’s function perturbation theory (AGF2)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Multi-configuration self-consistent field (MCSCF) </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Multi-configuration self-consistent field (MCSCF)</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-mcscf--page-root" class="md-nav__link">Multi-configuration self-consistent field (MCSCF)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#casci" class="md-nav__link">CASCI</a>
        </li>
        <li class="md-nav__item"><a href="#casscf" class="md-nav__link">CASSCF</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#picking-an-active-space" class="md-nav__link">Picking an Active Space</a>
        </li>
        <li class="md-nav__item"><a href="#frozen-orbital-mcscf" class="md-nav__link">Frozen-orbital MCSCF</a>
        </li>
        <li class="md-nav__item"><a href="#spin-state-of-cas-wavefunction" class="md-nav__link">Spin state of CAS wavefunction</a>
        </li>
        <li class="md-nav__item"><a href="#state-averaged-calculations" class="md-nav__link">State-Averaged Calculations</a>
        </li>
        <li class="md-nav__item"><a href="#job-control" class="md-nav__link">Job Control</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#optimization-settings" class="md-nav__link">Optimization Settings</a>
        </li>
        <li class="md-nav__item"><a href="#initial-guess" class="md-nav__link">Initial Guess</a>
        </li>
        <li class="md-nav__item"><a href="#restarting" class="md-nav__link">Restarting</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#observables-and-properties" class="md-nav__link">Observables and Properties</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#wave-function-analysis" class="md-nav__link">Wave Function Analysis</a>
        </li>
        <li class="md-nav__item"><a href="#natural-orbitals" class="md-nav__link">Natural Orbitals</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/mcscf.rst.txt">Show Source</a> </li>

  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mrpt.html" class="md-nav__link">Multi-reference perturbation theory (MRPT)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tddft.html" class="md-nav__link">Time-dependent Hartree-Fock and density functional theory</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="solvent.html" class="md-nav__link">Solvation models</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="qmmm.html" class="md-nav__link">QM/MM methods</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="md.html" class="md-nav__link">Molecular Dynamics</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="df.html" class="md-nav__link">Density fitting (DF)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pbc.html" class="md-nav__link">Periodic boundary conditions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="eph.html" class="md-nav__link">Electron-phonon coupling</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="lo.html" class="md-nav__link">Localized orbitals</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sgx.html" class="md-nav__link">Seminumerical exchange (SGX)</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="geomopt.html" class="md-nav__link">Geometry optimization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="reference.html" class="md-nav__link">References</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../pyscf_api_docs/pyscf.html" class="md-nav__link">API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../about.html" class="md-nav__link">About</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#user-mcscf--page-root" class="md-nav__link">Multi-configuration self-consistent field (MCSCF)</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#introduction" class="md-nav__link">Introduction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#casci" class="md-nav__link">CASCI</a>
        </li>
        <li class="md-nav__item"><a href="#casscf" class="md-nav__link">CASSCF</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#picking-an-active-space" class="md-nav__link">Picking an Active Space</a>
        </li>
        <li class="md-nav__item"><a href="#frozen-orbital-mcscf" class="md-nav__link">Frozen-orbital MCSCF</a>
        </li>
        <li class="md-nav__item"><a href="#spin-state-of-cas-wavefunction" class="md-nav__link">Spin state of CAS wavefunction</a>
        </li>
        <li class="md-nav__item"><a href="#state-averaged-calculations" class="md-nav__link">State-Averaged Calculations</a>
        </li>
        <li class="md-nav__item"><a href="#job-control" class="md-nav__link">Job Control</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#optimization-settings" class="md-nav__link">Optimization Settings</a>
        </li>
        <li class="md-nav__item"><a href="#initial-guess" class="md-nav__link">Initial Guess</a>
        </li>
        <li class="md-nav__item"><a href="#restarting" class="md-nav__link">Restarting</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#observables-and-properties" class="md-nav__link">Observables and Properties</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#wave-function-analysis" class="md-nav__link">Wave Function Analysis</a>
        </li>
        <li class="md-nav__item"><a href="#natural-orbitals" class="md-nav__link">Natural Orbitals</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="../_sources/user/mcscf.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="multi-configuration-self-consistent-field-mcscf">
<span id="user-mcscf"></span><h1 id="user-mcscf--page-root">Multi-configuration self-consistent field (MCSCF)<a class="headerlink" href="#user-mcscf--page-root" title="Link to this heading">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../pyscf_api_docs/pyscf.mcscf.html#module-pyscf.mcscf" title="pyscf.mcscf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyscf.mcscf</span></code></a></p>
<section id="introduction">
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Multiconfigurational self-consistent field (MCSCF) methods go beyond the single-determinant Hartree-Fock (HF) method by allowing the wave function to become a linear combination of multiple determinants.
While the configurations i.e. determinants can in principle be chosen in an arbitrary number of ways, PySCF focuses on the complete active space (CAS) family of methods, where the set of electron configurations is defined in terms of a given set of active orbitals, also known as the “active space”.
The CAS method generates all possible electron configurations that can be formed from the set of the active orbitals, and is therefore equivalent to an FCI procedure on a subset of the molecular orbitals; please see <a class="reference internal" href="ci.html#theory-ci"><span class="std std-ref">Configuration interaction (CISD and FCI)</span></a> for a discussion on the FCI method.
The use of MCSCF methods is crucial for reliable modeling of systems that exhibit nearly degenerate orbitals i.e. static correlation, such as transition metal complexes.
For a general discussion of MCSCF methods, we direct the reader to References <span id="id1">[<a class="reference internal" href="reference.html#id46" title="Trygve Helgaker, Poul Jorgensen, and Jeppe Olsen. Molecular Electronic-Structure Theory. Wiley, 2013. ISBN 9781118531471.">42</a>]</span> and <span id="id2">[<a class="reference internal" href="reference.html#id47" title="Esqc lectures 2019. URL: http://www.esqc.org/?page=lectures.">43</a>]</span>, and for specific details about PySCF’s implementation of CASSCF see <span id="id3">[<a class="reference internal" href="reference.html#id48" title="Qiming Sun, Jun Yang, and Garnet Kin-lic Lic Chan. A general second order complete active space self-consistent-field solver for large-scale systems. Chemical Physics Letters, 683:291–299, 2017. arXiv:1610.08394, doi:10.1016/j.cplett.2017.03.004.">44</a>]</span>.</p>
<p>The MCSCF module has two main flavors: CASCI and CASSCF.
In CASCI, the wave function is written as a linear combination of Slater determinants, and the expansion coefficients are solved in a variational procedure.
The orbitals are fixed in a CASCI calculation.
In contrast, in a CASSCF calculation, the orbitals are relaxed to minimize the resulting CASCI energy.
This means performing multiple CASCI steps followed by updates to the molecular orbitals, in analogy to Hartree-Fock calculations which also relies on iterative algorithms to minimize the HF energy with respect to the orbitals.</p>
<p>Minimal examples for each type of calculations are shown below.</p>
<section id="casci">
<h3 id="casci">CASCI<a class="headerlink" href="#casci" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">'O 0 0 0; O 0 0 1.2'</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">'ccpvdz'</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Use MP2 natural orbitals to define the active space for the single-point CAS-CI calculation</span>
<span class="n">mymp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">UMP2</span><span class="p">(</span><span class="n">myhf</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">noons</span><span class="p">,</span> <span class="n">natorbs</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">make_natural_orbitals</span><span class="p">(</span><span class="n">mymp</span><span class="p">)</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">natorbs</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="casscf">
<h3 id="casscf">CASSCF<a class="headerlink" href="#casscf" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyscf</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">'O 0 0 0; O 0 0 1.2'</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">'ccpvdz'</span><span class="p">,</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
 <span class="c1"># We can also run CAS calculations starting from the Hartree-Fock orbitals.</span>
 <span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Like many other modules in PySCF, <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> works with density-fitting (<a class="reference internal" href="df.html#user-df"><span class="std std-ref">Density fitting (DF)</span></a>) and x2c (<a class="reference internal" href="scf.html#user-x2c"><span class="std std-ref">Scalar relativistic correction</span></a>).
It can also be used in its unrestricted formulation, please see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/60-uhf_based_ucasscf.py">examples/mcscf/60-uhf_based_ucasscf.py</a> for an example.
An important feature of <code class="xref py py-mod docutils literal notranslate"><span class="pre">mcscf</span></code> is that it can interface with external CI solver such as DMRG, FCIQMC, or selected CI methods, see the external projects for more details.
You can even use MP2 or CC methods as solvers!
Check out <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master//examples/cc/42-as_casci_fcisolver.py">/examples/cc/42-as_casci_fcisolver.py</a> for a working example.</p>
</section>
</section>
<section id="picking-an-active-space">
<h2 id="picking-an-active-space">Picking an Active Space<a class="headerlink" href="#picking-an-active-space" title="Link to this heading">¶</a></h2>
<p>In general, selecting an active space can be cumbersome and PySCF offers severals ways to facilitate this process.
There are several strategies and they all contain two main components:</p>
<ul class="simple">
<li><p>Specify the number of electrons and orbitals in the active space.</p></li>
<li><p>(Optional) Specify the which orbitals are “active”</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We always advise users to visualize their chosen active orbitals before starting large/expensive calculations.
This involves dumping the MO coefficients to a <code class="docutils literal notranslate"><span class="pre">molden</span></code> file (see example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/tools/02-molden.py">examples/tools/02-molden.py</a>) and visualizing with your chosen program.
While there are many great softwares available to visualize orbitals, <a class="reference external" href="http://jmol.sourceforge.net/">JMol</a> is one of the easiest to use and is recommended for less experienced users.</p>
</div>
<p>Below is a list of several general strategies one could employ to pick active space orbitals:</p>
<ol class="arabic simple">
<li><p>(Default) Specifying no additional information.</p></li>
</ol>
<blockquote>
<div><p>This is the most minimal strategy for selecting an active space and chooses orbitals (and electrons) around the Fermi level that match the number of orbitals and electrons specified by the user.
In most circumstances, this is not an ideal strategy and will lead to poor convergence or none at all.</p>
<p>For example:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hartree-Fock orbitals are often poor for systems with significant static correlation.
In such cases, orbitals from density functional calculations often yield better starting points for CAS calculations.</p>
</div>
<ol class="arabic simple" start="2">
<li><p>Specifying the active space orbitals as a list of molecular orbital (MO) indices.
This is often useful combined with a visual analysis of localized orbitals (see the section on localized orbitals).</p></li>
</ol>
<blockquote>
<div><p>The user can select the MO orbital indices “manually” and pass them to the <code class="docutils literal notranslate"><span class="pre">sort_mo</span></code> function. NB! The orbitals are numbered from 1, not 0.
See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/10-define_cas_space.py">examples/mcscf/10-define_cas_space.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a> for more details.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># Note sort_mo by default take the 1-based orbital indices.</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mycas</span><span class="o">.</span><span class="n">sort_mo</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>3) Specifying the number of orbitals in each symmetry group.
This strategy is often helpful when the system has a high degree of symmetry, or when there is no physically evident best choise for the active orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">ncore</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'A1g'</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'A1u'</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">ncas</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'A1g'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'A1u'</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">'E1ux'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E1uy'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E1gx'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E1gy'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">'E2ux'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E2uy'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E2gx'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'E2gy'</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">sort_mo_by_irrep</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">ncore</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>A similar approach where we specify the number of electrons in each irreducible representation is also possible by setting <code class="docutils literal notranslate"><span class="pre">mycas.fcisolver.irrep_nelec</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">fcisolver</span><span class="o">.</span><span class="n">irrep_nelec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"A1g"</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">"A1u"</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">"E1ux"</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">"E1uy"</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This strategy is often combined with calculations at a lower level of theory.
For instance, MP2 or CISD natural orbitals and their occupation numbers can be used determine the suitable active space in each symmetry block.
Natural orbitals with occupations close to 2 are strongly occupied, and can be frozen in the CAS calculation.
Natural orbitals with small occupation numbers can likewise be omitted from the active space.</p>
</div>
<p>4) Use automated strategies (<code class="docutils literal notranslate"><span class="pre">avas</span></code> and <code class="docutils literal notranslate"><span class="pre">dmet_cas</span></code>) to pick an active space based on AO orbitals you’re targeting.
For more details, see <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a> and <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">avas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Fe 3d'</span><span class="p">,</span> <span class="s1">'Fe 4d'</span><span class="p">,</span> <span class="s1">'C 2pz'</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">orbs</span> <span class="o">=</span> <span class="n">avas</span><span class="o">.</span><span class="n">avas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.mcscf</span> <span class="kn">import</span> <span class="n">dmet_cas</span>
<span class="n">ao_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Fe 3d'</span><span class="p">,</span> <span class="s1">'Fe 4d'</span><span class="p">,</span> <span class="s1">'C 2pz'</span><span class="p">]</span>
<span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">,</span> <span class="n">mo</span> <span class="o">=</span> <span class="n">dmet_cas</span><span class="o">.</span><span class="n">guess_cas</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(),</span> <span class="n">ao_labels</span><span class="p">)</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">ncas</span><span class="p">,</span> <span class="n">nelecas</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="frozen-orbital-mcscf">
<h2 id="frozen-orbital-mcscf">Frozen-orbital MCSCF<a class="headerlink" href="#frozen-orbital-mcscf" title="Link to this heading">¶</a></h2>
<p>Orbitals can be frozen in the orbital optimization to e.g. reduce the computational effort of CASSCF calculations.
The orbitals will remain fixed throughout the optimization.</p>
<p>Users can specify the number of lowest orbitals to freeze:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Users can also specify a list of orbital indices (0-based).
These may be occupied, virtual, or active orbitals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">]</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/19-frozen_orbital.py">examples/mcscf/19-frozen_orbital.py</a> for a complete example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>frozen</cite> keyword of the CASSCF optimizer should not be confused with the <cite>frozen</cite> keyword of the FCI solver, which controls the number of orbitals that are constrained to be doubly occupied.</p>
</div>
</section>
<section id="spin-state-of-cas-wavefunction">
<h2 id="spin-state-of-cas-wavefunction">Spin state of CAS wavefunction<a class="headerlink" href="#spin-state-of-cas-wavefunction" title="Link to this heading">¶</a></h2>
<p>Multiconfigurational wavefunction provided by the
the <cite>pyscf.fci</cite> solver is typically spin-adapted, but there is no direct
control of the spin multiplicity (i.e. S^2 value). It is, nevertheless, possible
to define the spin projection Sz of the obtained WF, which helps to fix the spin
multiplicity in most of the cases. By default, the MCSCF uses the setting in
<code class="xref py py-attr docutils literal notranslate"><span class="pre">mol.spin</span></code> for the value of 2*Sz.</p>
<p>You can change the number of alpha and beta electrons in the active space.
The Sz value of the MCSCF wavefunction can differ from <code class="xref py py-attr docutils literal notranslate"><span class="pre">mol.spin</span></code>.</p>
<p>For example, you can start from <cite>Sz=0</cite> RHF calculations, and then change the
number of alpha and beta electrons in the active space to solve higher
spin states, such as the triplet state.```</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># 5 alpha electrons, 3 beta electrons</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>Another common scenario to adjust the spin settings is the caulations of
transition-metal systems. For transition-metal system with open d shell, one can
start with single-reference maximum-Sz state and then switch to more complicated
low-spin states in CASSCF.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">ROHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>It may happen that a wave function of correct Sz is achieved while
S^2 is wrong. This issue may either be caused by convergence onto
another spin state, or spin contamination in the CAS wave function.</p>
<p>Such issues can be circumvented with the <code class="xref py py-func docutils literal notranslate"><span class="pre">fix_spin_()</span></code> method
of the CASCI/CASSCF class, which is able to correct the spin state
by biasing the calculation towards the wanted state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">myhf</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">RHF</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Targeting triplet state with Sz=0</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">fix_spin_</span><span class="p">(</span><span class="n">ss</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">fix_spin_()</span></code> is an energy-penalty method. It may affect the efficiency and
accuracy of the CASCI and CASSCF algorithms. It should not be used unless
the MCSCF program has difficulties in finding the wanted spin state.</p>
<p>In example <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/02-cas_space_spin.py">examples/mcscf/02-cas_space_spin.py</a> and
<a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/18-spatial_spin_symmetry.py.py">examples/mcscf/18-spatial_spin_symmetry.py.py</a>, you can find the
complete scripts to tune spin states of the CASCI/CASSCF wavefunctions.</p>
</section>
<section id="state-averaged-calculations">
<h2 id="state-averaged-calculations">State-Averaged Calculations<a class="headerlink" href="#state-averaged-calculations" title="Link to this heading">¶</a></h2>
<p>When your system has states that are close-by in energy, their ordering may change during the orbital optimization and result in non-convergence of the CASSCF optimization.
In such cases it is often helpful to optimize the orbitals for a state average.
The <code class="docutils literal notranslate"><span class="pre">state_average_</span></code> function (note the hanging underscore) is a member function of <code class="docutils literal notranslate"><span class="pre">CASCI</span></code>/<code class="docutils literal notranslate"><span class="pre">CASSCF</span></code> objects and takes the weights of the states as input.
The weights can be any normalized and non-negative array of values, but equal weights are typically used.
See Section 12.7.2 in Ref. <span id="id4">[<a class="reference internal" href="reference.html#id46" title="Trygve Helgaker, Poul Jorgensen, and Jeppe Olsen. Molecular Electronic-Structure Theory. Wiley, 2013. ISBN 9781118531471.">42</a>]</span> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_states</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_states</span><span class="p">)</span><span class="o">/</span><span class="n">n_states</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">state_average_</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/15-state_average.py">examples/mcscf/15-state_average.py</a> for a complete example.</p>
<p>By default, only a single spin and/or point group symmetry is targeted, but it is possible to target a mixture of both:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]</span>
<span class="n">solver1</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">'A1'</span>
<span class="n">solver1</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">solver2</span> <span class="o">=</span> <span class="n">fci</span><span class="o">.</span><span class="n">direct_spin1_symm</span><span class="o">.</span><span class="n">FCI</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">wfnsym</span><span class="o">=</span> <span class="s1">'A2'</span>
<span class="n">solver2</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">mcscf</span><span class="o">.</span><span class="n">state_average_mix_</span><span class="p">(</span><span class="n">mycas</span><span class="p">,</span> <span class="p">[</span><span class="n">solver1</span><span class="p">,</span> <span class="n">solver2</span><span class="p">],</span> <span class="n">weights</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/41-state_average.py">examples/mcscf/41-state_average.py</a> for a complete example.</p>
</section>
<section id="job-control">
<h2 id="job-control">Job Control<a class="headerlink" href="#job-control" title="Link to this heading">¶</a></h2>
<section id="optimization-settings">
<h3 id="optimization-settings">Optimization Settings<a class="headerlink" href="#optimization-settings" title="Link to this heading">¶</a></h3>
<p>For CASSCF calculations, users may want to modify several of the convergence thresholds such as the energy (<code class="docutils literal notranslate"><span class="pre">conv_tol</span></code>), the orbital gradient (<code class="docutils literal notranslate"><span class="pre">conv_tol_grad</span></code>), and the maximum number of MCSCF iterations (<code class="docutils literal notranslate"><span class="pre">max_cycle_macro</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">conv_tol_grad</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">max_cycle_macro</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="initial-guess">
<h3 id="initial-guess">Initial Guess<a class="headerlink" href="#initial-guess" title="Link to this heading">¶</a></h3>
<p>Initial guess orbitals for the CASSCF calculation (starting orbitals) may be passed to the <code class="docutils literal notranslate"><span class="pre">kernel</span></code> member function of an MCSCF object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">my_custom_mos</span><span class="p">)</span>
</pre></div>
</div>
<p>CI coefficients from a previous calculation can also be passed as an initial guess to expedite the calculation:</p>
<p>Examples:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/14-project_init_guess.py">examples/mcscf/14-project_init_guess.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/31-cr2_scan/cr2-scan.py">examples/mcscf/31-cr2_scan/cr2-scan.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/34-init_guess_localization.py">examples/mcscf/34-init_guess_localization.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-avas.py">examples/mcscf/43-avas.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/43-dmet_cas.py">examples/mcscf/43-dmet_cas.py</a></p></li>
</ul>
</section>
<section id="restarting">
<h3 id="restarting">Restarting<a class="headerlink" href="#restarting" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When running large calculations, it’s always recommended that you specify a checkpoint file for your calculation.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">"casscf.chk"</span>
</pre></div>
</div>
<p>Much like <code class="xref py py-mod docutils literal notranslate"><span class="pre">scf</span></code>, if a job is interrupted, users can restart the MCSCF calculations using checkpoint files from a crashed calculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">chkfile</span>
<span class="n">old_chk_file</span> <span class="o">=</span> <span class="s2">"old_casscf.chk"</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s2">"restarted_casscf.chk"</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">chkfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">old_chk_file</span><span class="p">,</span> <span class="s1">'mcscf/mo_coeff'</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/mcscf/13-restart.py">examples/mcscf/13-restart.py</a> for a complete example.</p>
<p>Restarting calculations can be also be useful when using results from a smaller active space to speed up calculations on a larger one.</p>
</section>
</section>
<section id="observables-and-properties">
<h2 id="observables-and-properties">Observables and Properties<a class="headerlink" href="#observables-and-properties" title="Link to this heading">¶</a></h2>
<section id="wave-function-analysis">
<h3 id="wave-function-analysis">Wave Function Analysis<a class="headerlink" href="#wave-function-analysis" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">analyze</span></code> member functions of MCSCF objects prints many useful properties to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> when the verbosity is &gt;=4.</p>
<ol class="arabic simple">
<li><p>Natural orbital occupancies</p></li>
<li><p>Natural orbital AO expansions</p></li>
<li><p>Overlap between canonical MCSCF orbitals and the initial guess orbitals.</p></li>
<li><p>Analysis of the CI coefficients, i.e. the leading configurations and their weights</p></li>
<li><p>AO populations</p></li>
<li><p>Atomic populations</p></li>
<li><p>AO spin densities (if applicable)</p></li>
<li><p>Atomic spin densities (if applicable)</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">myhf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="natural-orbitals">
<h3 id="natural-orbitals">Natural Orbitals<a class="headerlink" href="#natural-orbitals" title="Link to this heading">¶</a></h3>
<p>The CAS wave function is invariant under orbital rotation within the inactive core, active, and inactive virtual spaces.
The inactive core and virtual orbitals are by default canonicalized, i.e., they are transformed by block-diagonalizing the generalized Fock matrix within the inactive core and virtual subblocks.
This also yields energy eigenvalues for the inactive core and virtual orbitals.
In contrast, no energy or electron occupation can be assigned to the active orbitals, strictly speaking.
The user may request the active orbitals to be transformed to the so-called natural representation, in which the reduced one-body density matrix is diagonal, and the formal natural orbital occupation numbers can be found on its diagonal.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When <code class="docutils literal notranslate"><span class="pre">mycas.natorb</span></code> is set, the natural orbitals may NOT be sorted by the active space occupancy.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">myhf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">natorb</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="agf2.html" title="Auxiliary second-order Green’s function perturbation theory (AGF2)"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Auxiliary second-order Green’s function perturbation theory (AGF2) </span>
              </div>
            </a>
          
          
            <a href="mrpt.html" title="Multi-reference perturbation theory (MRPT)"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Multi-reference perturbation theory (MRPT) </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2015-2021, The PySCF Developers.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>